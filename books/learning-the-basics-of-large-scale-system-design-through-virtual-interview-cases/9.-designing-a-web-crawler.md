---
description: 웹 크롤러 설계
---

# 9. Designing a Web Crawler

웹 크롤러는 인터넷 상의 웹 페이지를 자동으로 탐색하고 데이터를 수집하는 중요한 도구입니다. 이러한 크롤러는 검색 엔진 인덱싱, 웹 아카이빙, 웹 마이닝, 웹 모니터링과 같은 다양한 응용 분야에서 활용됩니다.



## 웹 크롤러의 주요 활용 사례

**검색 엔진 인덱싱**

웹 크롤러는 검색 엔진에서 웹 페이지를 자동으로 수집하고 인덱스를 구축하는 데 핵심적인 역할을 합니다. 이를 통해 사용자는 전 세계의 정보를 검색할 수 있으며, 검색 엔진은 크롤러가 수집한 데이터를 바탕으로 검색 결과를 제공합니다.

**웹 아카이빙**

웹 크롤러는 특정 시점의 웹 페이지를 수집하고 저장하여, 시간이 지나도 해당 콘텐츠를 보존할 수 있도록 합니다. 이는 인터넷 아카이브와 같은 프로젝트에서 사용되며, 시간이 지나면서 사라지는 웹 콘텐츠를 기록하는 데 중요한 역할을 합니다.

**웹 마이닝**

웹 마이닝은 웹 크롤러를 사용하여 다양한 데이터를 수집하고, 이를 분석하여 유용한 정보를 도출하는 과정입니다. 기업들은 웹 마이닝을 통해 시장 동향, 소비자 선호도, 경쟁사 분석 등을 수행할 수 있습니다.

**웹 모니터링**

웹 크롤러는 특정 웹사이트나 페이지의 변화를 지속적으로 모니터링하는 데 사용됩니다. 이는 가격 비교 사이트, 뉴스 모니터링 서비스, 경쟁사 웹사이트 감시 등의 다양한 목적으로 활용될 수 있습니다.



## 1단계: 문제 이해 및 설계 범위 확정

**1.1 규모, 확장성, 안정성, 예절, 확장성**

웹 크롤러 설계에서 중요한 요소는 시스템의 **규모**와 **확장성**입니다. 크롤러는 인터넷 상의 방대한 양의 데이터를 처리할 수 있어야 하며, 데이터 수집량이 증가하더라도 성능 저하 없이 확장 가능해야 합니다. **안정성**은 시스템이 장애 상황에서도 안정적으로 동작할 수 있도록 보장해야 하며, **예절**은 크롤러가 웹사이트의 정책을 준수하고, 서버에 과도한 부하를 주지 않도록 신중하게 동작해야 함을 의미합니다.

**1.2 개략적 규모 추정**

크롤러 설계를 시작하기 전에 시스템이 처리해야 할 데이터의 규모를 추정하는 것이 중요합니다. 크롤링 대상 웹 페이지의 수, 페이지당 평균 크기, 일일 크롤링 빈도 등을 고려하여 전체 데이터 수집량을 추정할 수 있습니다. 이 추정치는 하드웨어 요구사항, 네트워크 대역폭, 저장소 용량 등을 결정하는 데 중요한 기준이 됩니다.



## 2단계: 개략적 설계안 제시 및 동의 구하기

### **2.1 시작 URL 집합**

웹 크롤러는 초기 크롤링 대상이 되는 **시작 URL 집합**에서 작업을 시작합니다. 이 집합은 크롤러가 첫 번째로 방문할 URL 목록을 포함하며, 이후에 크롤링할 페이지를 탐색하는 출발점이 됩니다. 시작 URL은 수동으로 지정하거나, 기존의 인덱스에서 추출할 수 있습니다.

### **2.2 미수집 URL 저장소**

크롤러는 아직 방문하지 않은 URL을 **미수집 URL 저장소**에 저장합니다. 이 저장소는 크롤러가 탐색해야 할 URL 목록을 관리하며, 새로운 URL이 발견될 때마다 이 목록에 추가됩니다. 미수집 URL 저장소는 효율적인 큐(queue) 형태로 관리되며, 크롤러는 이 목록에서 다음에 크롤링할 URL을 선택합니다.

### **2.3 HTML 다운로더**

**HTML 다운로더**는 지정된 URL로부터 웹 페이지를 다운로드하는 역할을 합니다. 다운로더는 HTTP 요청을 통해 페이지를 가져오고, 응답으로 받은 HTML 문서와 관련 리소스를 처리합니다. 다운로더는 SSL/TLS를 지원하여 보안을 유지하고, 리다이렉션 및 쿠키를 관리할 수 있어야 합니다.

### **2.4 도메인 이름 변환기**

**도메인 이름 변환기**는 URL에 포함된 도메인 이름을 IP 주소로 변환하는 DNS 조회를 수행합니다. 이는 크롤러가 웹 서버에 접근할 수 있도록 하기 위한 필수 과정입니다. 도메인 이름 변환기는 자주 사용하는 도메인에 대해 캐시를 유지하여 성능을 최적화할 수 있습니다.

### **2.5 콘텐츠 파서**

**콘텐츠 파서**는 다운로드한 HTML 문서에서 유용한 정보를 추출하는 역할을 합니다. 파서는 DOM(Document Object Model)을 분석하여 웹 페이지의 구조를 이해하고, 필요한 데이터를 추출합니다. 파서는 또한 페이지에서 다른 링크를 추출하여 새로운 URL로 전달합니다.

### **2.6 중복 콘텐츠 검사**

웹 크롤러는 수집한 콘텐츠가 중복된 것인지 여부를 판단해야 합니다. **중복 콘텐츠 검사기**는 해시 값이나 특정 알고리즘을 사용하여 이미 수집된 콘텐츠와 새로 수집된 콘텐츠를 비교합니다. 중복된 콘텐츠는 저장되지 않으며, 이는 저장소 공간을 절약하고, 불필요한 작업을 줄이는 데 기여합니다.

### **2.7 콘텐츠 저장소**

**콘텐츠 저장소**는 수집된 데이터를 저장하고 관리하는 역할을 합니다. 이 저장소는 수집된 HTML 문서, 메타데이터, 파싱된 정보 등을 포함하며, 필요 시 검색 인덱스를 구축할 수 있도록 데이터를 구조화하여 저장합니다.

### **2.8 URL 추출기**

**URL 추출기**는 수집된 웹 페이지에서 다른 페이지로 연결된 하이퍼링크를 분석하고, 새로운 URL을 추출하는 역할을 합니다. 이 과정에서 URL 추출기는 HTML 파싱을 통해 페이지 내의 `<a>` 태그, `<link>` 태그 등을 분석하여 유효한 URL을 식별합니다.

### **2.9 URL 필터**

**URL 필터**는 특정 기준에 따라 URL을 필터링하는 역할을 합니다. 예를 들어, 크롤러는 특정 도메인 내에서만 작동하도록 설정될 수 있으며, URL 필터는 이러한 도메인 외부의 링크를 필터링합니다. 또한, 중복된 URL이나 비정상적인 패턴을 가진 URL을 제거하여 효율적인 크롤링을 보장합니다.

### **2.10 이미 방문한 URL 검사**

**이미 방문한 URL 검사기**는 크롤러가 이전에 방문한 적이 있는 URL을 식별합니다. 이를 통해 동일한 페이지를 반복적으로 크롤링하는 것을 방지할 수 있습니다. 이 과정에서 해시 테이블이나 블룸 필터를 사용하여 URL을 빠르게 조회하고 관리할 수 있습니다.

### **2.11 URL 저장소**

**URL 저장소**는 크롤러가 수집한 모든 URL을 기록하고 관리하는 역할을 합니다. 이 저장소는 크롤링이 완료된 URL, 크롤링 중인 URL, 그리고 미래에 크롤링할 URL 등을 저장하며, 이를 기반으로 크롤러의 진행 상황을 추적할 수 있습니다.

### **2.12 웹 크롤러 작업 흐름**

웹 크롤러의 전체 **작업 흐름**은 다음과 같이 요약할 수 있습니다:

1. 시작 URL 집합에서 크롤링을 시작합니다.
2. 미수집 URL 저장소에 저장된 URL을 가져와 HTML 다운로더가 해당 페이지를 다운로드합니다.
3. 도메인 이름 변환기를 통해 DNS 조회를 수행하고, 콘텐츠 파서가 다운로드된 페이지를 분석하여 URL을 추출합니다.
4. URL 필터와 중복 콘텐츠 검사를 통해 유효한 URL과 콘텐츠를 식별하고, 이를 콘텐츠 저장소와 URL 저장소에 저장합니다.
5. 크롤러는 이미 방문한 URL을 필터링한 후, 새로운 URL을 미수집 URL 저장소에 추가합니다.
6. 이 과정은 설정된 크롤링 범위에 도달할 때까지 반복됩니다.



## 3단계: 상세 설계

### **3.1 DFS를 쓸 것인가, BFS를 쓸 것인가**

웹 크롤러의 크롤링 전략으로는 깊이 우선 탐색(DFS)와 너비 우선 탐색(BFS) 중 하나를 선택할 수 있습니다. **DFS**는 크롤러가 특정 경로를 따라 가능한 한 깊이 들어가는 방식으로, 특정 주제에 집중하여 크롤링할 때 유용합니다. 반면 **BFS**는 크롤러가 동일한 깊이의 모든 페이지를 크롤링한 후, 다음 깊이로 이동하는 방식으로, 전반적인 웹 페이지 탐색에 적합합니다.

### **3.2 미수집 URL 저장소의 설계**

**미수집 URL 저장소**는 크롤러가 아직 방문하지 않은 URL을 관리하는 중요한 구성 요소입니다. 이 저장소는 큐나 리스트 구조로 관리되며, 크롤러는 여기에서 다음에 크롤링할 URL을 선택합니다. 저장소는 디스크 기반 데이터베이스나 메모리 기반 캐시로 구현될 수 있으며, 대규모 크롤링 작업에서는 이 저장소가 매우 중요합니다.

### **3.3 예의, 우선순위, 신선도, 미수집 URL 저장소를 위한 지속성 저장 장치**

* **예의**: 크롤러는 웹사이트의 `robots.txt` 파일을 준수하여, 허용된 영역에서만 크롤링해야 합니다.
* **우선순위**: 중요도에 따라 URL의 우선순위를 설정하고, 이를 기반으로 크롤링 순서를 결정합니다.
* **신선도**: 최근 업데이트된 페이지를 우선적으로 크롤링하여 최신 데이터를 유지합니다.
* **지속성 저장 장치**: 미수집 URL 저장소는 시스템 장애나 크롤러 재시작 시에도 데이터를 유지할 수 있도록 지속성 저장 장치로 구현됩니다.

### **3.4 HTML 다운로더**

**HTML 다운로더**는 크롤러의 핵심 모듈로, 웹 페이지를 실제로 다운로드하는 역할을 합니다. 이 모듈은 네트워크 요청을 처리하고, 다양한 HTTP 상태 코드를 관리하며, SSL/TLS 암호화를 지원합니다. 다운로더는 성능 최적화를 위해 비동기 요청을 처리할 수 있어야 하며, 리다이렉션, 쿠키, 타임아웃 설정을 포함합니다.

### **3.5 robots.txt, 성능 최적화, 분산 크롤링, 도메인 이름 변환 결과 캐시, 지역성, 짧은 타임아웃**

* **robots.txt**: 크롤러는 `robots.txt` 파일을 분석하여 허용된 URL만 크롤링해야 하며, 이를 통해 웹사이트의 요청을 준수합니다.
* **성능 최적화**: 다운로더의 성능을 극대화하기 위해 타임아웃을 짧게 설정하고, 비동기 I/O를 활용하여 대기 시간을 최소화합니다.
* **분산 크롤링**: 대규모 크롤링 작업을 위해 여러 크롤러 인스턴스를 분산 환경에서 실행하여 작업을 병렬로 수행합니다.
* **도메인 이름 변환 결과 캐시**: 자주 접근하는 도메인의 DNS 결과를 캐싱하여, 반복적인 DNS 조회를 피하고 성능을 향상시킵니다.
* **지역성**: 동일한 도메인 내의 여러 페이지를 연속적으로 크롤링하여 네트워크 비용을 절감하고, 서버 부하를 줄입니다.
* **짧은 타임아웃**: 비정상적으로 느린 응답을 처리하기 위해 짧은 타임아웃을 설정하여, 크롤러가 대기 상태에 빠지지 않도록 합니다.

### **3.6 안정성, 안정 해시, 크롤링 상태 및 수집 데이터 저장, 예외 처리, 데이터 검증**

* **안정성**: 크롤러는 장애 발생 시에도 안정적으로 동작해야 하며, 이를 위해 장애 복구 메커니즘을 설계합니다.
* **안정 해시**: 크롤링된 데이터의 무결성을 보장하기 위해 안정적인 해시 알고리즘을 사용하여 데이터의 일관성을 검증합니다.
* **크롤링 상태 저장**: 크롤러의 진행 상황을 주기적으로 기록하여, 재시작 시 해당 시점부터 작업을 재개할 수 있도록 합니다.
* **예외 처리**: 네트워크 오류, 서버 오류 등의 다양한 예외 상황을 처리할 수 있는 로직을 구현하여 시스템의 신뢰성을 높입니다.
* **데이터 검증**: 수집된 데이터의 무결성을 확인하고, 문제가 있는 데이터를 식별하여 저장되지 않도록 합니다.

### **3.7 확장성**

크롤러는 확장 가능한 구조로 설계되어야 하며, 시스템이 증가하는 데이터 수집량에 유연하게 대응할 수 있어야 합니다. 이를 위해 분산 처리 아키텍처를 도입하고, 필요에 따라 서버를 추가하거나 저장소를 확장할 수 있는 메커니즘을 마련합니다.

### **3.8 문제 있는 콘텐츠 감지 및 회피**

크롤러는 **문제 있는 콘텐츠**를 감지하고, 이를 회피할 수 있어야 합니다. 이러한 콘텐츠는 다음과 같습니다:

* **중복 콘텐츠**: 이미 수집된 페이지와 동일한 콘텐츠를 포함하는 페이지는 중복으로 간주되어 저장되지 않습니다.
* **거미 덫**: 크롤러가 무한 루프에 빠지도록 유도하는 페이지를 감지하고, 이를 회피하도록 설계합니다.
* **데이터 노이즈**: 수집된 데이터 중 의미 없는 데이터나 잘못된 정보를 걸러내고, 유용한 데이터만을 저장합니다.



## 4단계: 마무리

### **4.1 서버 측 렌더링 및 원치 않는 페이지 필터링**

* **서버 측 렌더링**: 일부 웹 페이지는 자바스크립트를 사용하여 동적으로 생성됩니다. 크롤러는 이러한 페이지를 정확히 수집하기 위해 서버 측 렌더링을 지원할 수 있어야 합니다.
* **원치 않는 페이지 필터링**: 특정 패턴이나 규칙에 따라 원치 않는 페이지를 필터링하여, 불필요한 데이터를 수집하지 않도록 설정합니다.

### **4.2 데이터베이스 다중화 및 샤딩**

* **데이터베이스 다중화**: 크롤링된 데이터를 저장하는 데이터베이스는 다중화되어야 하며, 이를 통해 데이터 손실 방지와 성능 향상을 도모할 수 있습니다.
* **샤딩**: 대규모 데이터를 효율적으로 관리하기 위해 데이터베이스 샤딩을 도입하여 데이터를 분할 저장합니다.

### **4.3 수평적 규모 확장성, 가용성, 일관성, 안정성**

* **수평적 규모 확장성**: 시스템의 확장성을 위해 수평적 확장을 지원하여, 서버나 저장소를 필요에 따라 추가할 수 있도록 설계합니다.
* **가용성, 일관성, 안정성**: 시스템은 높은 가용성과 일관성을 유지하며, 안정적으로 동작해야 합니다. 이를 위해 데이터 복제, 분산 처리, 예외 처리 메커니즘을 갖추어야 합니다.

### **4.4 데이터 분석 솔루션**

크롤러가 수집한 데이터는 **데이터 분석 솔루션**을 통해 유용한 인사이트를 제공할 수 있습니다. 이를 위해 수집된 데이터를 정제하고, 분석할 수 있는 플랫폼을 구축하며, 결과를 시각화하여 의사결정에 활용합니다.
