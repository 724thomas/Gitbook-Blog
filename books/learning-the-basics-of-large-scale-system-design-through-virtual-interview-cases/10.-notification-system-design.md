---
description: 알림 시스템 설계
---

# 10. Notification System Design

알림 시스템은 다양한 사용자가 필요로 하는 정보나 이벤트를 실시간으로 전달하기 위해 설계된 중요한 시스템입니다. 오늘날 대규모 애플리케이션은 사용자가 필요한 정보에 빠르게 접근할 수 있도록 하는 알림 시스템을 갖추고 있으며, 이는 사용자의 경험을 향상시키는 중요한 요소로 자리잡고 있습니다.

## 1. 문제 정의

알림 시스템의 주요 목적은 사용자가 시스템에서 발생하는 중요한 이벤트에 대해 빠르게 인지할 수 있도록 알림을 전달하는 것입니다. 이를 위해 시스템은 다음과 같은 기능을 제공해야 합니다.

* **다양한 채널 지원**: 이메일, SMS, 푸시 알림 등 다양한 방법으로 알림을 보낼 수 있어야 합니다.
* **높은 확장성**: 수백만 명의 사용자에게 동시에 알림을 보낼 수 있어야 합니다.
* **낮은 지연 시간**: 이벤트 발생 후 가능한 빨리 알림을 전달해야 합니다.
* **사용자 설정 지원**: 각 사용자가 자신의 알림 수신 방법을 설정할 수 있어야 합니다.



## 2. 고수준 설계

알림 시스템의 고수준 아키텍처는 다음과 같은 구성 요소로 나눌 수 있습니다.

1. **이벤트 생성기**: 시스템에서 발생하는 이벤트를 감지하여 알림 시스템에 전달하는 역할을 합니다.
2. **이벤트 큐**: 이벤트 생성기로부터 수신된 이벤트를 큐에 저장하여 알림 서비스로 전달합니다.
3. **알림 생성기**: 이벤트를 처리하여 알림을 생성합니다. 사용자의 알림 설정에 따라 알림의 형태와 채널을 결정합니다.
4. **알림 전송기**: 생성된 알림을 사용자가 설정한 채널로 전송합니다.
5. **알림 로그**: 전송된 알림의 기록을 보관하여 추적 및 분석을 가능하게 합니다.



## 3. 세부 설계

### **3.1 이벤트 생성 및 큐잉**

이벤트 생성기는 시스템 내의 다양한 서비스에서 발생하는 이벤트를 수집합니다. 이 이벤트는 특정 사용자의 동작일 수도 있고, 시스템에서 감지한 이상 상황일 수도 있습니다. 이벤트는 일단 생성된 후 이벤트 큐에 저장됩니다.

이벤트 큐는 메시지 큐 또는 스트림 처리 플랫폼으로 구현할 수 있으며, 여기서 중요한 것은 이벤트의 순서 보장과 확장성입니다. 일반적으로 Apache Kafka, RabbitMQ 같은 메시지 브로커를 사용하여 이러한 요구 사항을 충족시킬 수 있습니다.

### **3.2 알림 생성기**

알림 생성기는 이벤트 큐로부터 이벤트를 수신하여 알림을 생성합니다. 이 단계에서는 다음과 같은 작업이 이루어집니다.

* **이벤트 처리**: 이벤트의 유형에 따라 알림 메시지를 생성합니다.
* **사용자 설정 확인**: 사용자별 알림 설정을 조회하여 어떤 채널로 알림을 보낼지 결정합니다.
* **알림 스케줄링**: 필요에 따라 알림을 즉시 보내지 않고, 예약된 시간에 발송할 수 있도록 합니다.

이 과정에서는 사용자가 알림을 어떻게 받기를 원하는지에 대한 정보를 기반으로 맞춤형 알림이 생성됩니다.

### **3.3 알림 전송기**

알림 전송기는 알림 생성기에서 생성된 알림을 실제 사용자에게 전달하는 역할을 합니다. 이 때 여러 가지 채널을 통해 알림을 전송할 수 있으며, 각 채널은 다음과 같은 방식으로 구현됩니다.

* **이메일**: SMTP 서버를 통해 이메일을 발송합니다.
* **SMS**: SMS 게이트웨이를 통해 메시지를 발송합니다.
* **푸시 알림**: 모바일 기기나 웹 브라우저로 푸시 알림을 전송합니다.

각 채널은 독립적으로 운영되며, 전송 실패 시 재시도 메커니즘을 가지고 있어야 합니다. 예를 들어, 이메일 전송 실패 시 다른 이메일 서버를 이용해 재전송할 수 있는 기능이 필요합니다.



## 4. 확장성과 가용성

대규모 알림 시스템은 수많은 이벤트와 사용자 요청을 처리해야 하기 때문에 높은 확장성이 필요합니다. 이를 위해 다음과 같은 방식을 적용할 수 있습니다.

* **수평적 확장**: 알림 생성기와 전송기를 여러 대의 서버에 분산시켜 운영하여 처리량을 늘립니다.
* **파티셔닝**: 이벤트와 알림 데이터를 파티셔닝하여 여러 노드에서 병렬로 처리할 수 있도록 합니다.
* **지연 처리**: 비동기 처리를 통해 이벤트와 알림의 병목 현상을 줄이고 시스템의 응답성을 유지합니다.

또한, 가용성을 높이기 위해 이벤트 큐와 데이터베이스의 복제 및 장애 복구 전략을 설계해야 합니다. 장애 발생 시에도 시스템이 안정적으로 작동하고, 알림이 유실되지 않도록 설계해야 합니다.



## 5. 사용자 맞춤형 알림

알림 시스템은 사용자의 요구와 선호도에 따라 맞춤형으로 동작해야 합니다. 이를 위해 다음과 같은 기능이 필요합니다.

* **사용자 프로필 관리**: 각 사용자의 알림 선호도를 저장하고 관리합니다.
* **알림 필터링**: 사용자가 관심 있는 알림만 수신할 수 있도록 필터링 기능을 제공합니다.
* **다중 채널 지원**: 사용자가 원하는 채널로만 알림을 받을 수 있도록 채널 선택 기능을 제공합니다.

예를 들어, 사용자가 이메일과 푸시 알림 중 푸시 알림만 받기를 원한다면, 시스템은 이 설정에 따라 푸시 알림만 발송하도록 해야 합니다.



## 6. 장애 처리

알림 시스템은 고가용성을 요구하며, 이를 위해 장애 처리 메커니즘이 필수적입니다. 장애가 발생했을 때는 다음과 같은 전략을 사용할 수 있습니다.

* **재시도 로직**: 알림 전송에 실패했을 때 일정 횟수만큼 재시도를 수행합니다.
* **장애 감지**: 알림 전송 과정에서 문제가 발생했는지 모니터링하고, 자동으로 관리자에게 보고하는 시스템을 구축합니다.
* **데이터 복구**: 장애로 인해 손실된 알림 데이터를 복구할 수 있는 기능을 설계합니다.

장애가 발생하더라도 사용자는 시스템의 안정성을 느낄 수 있어야 하며, 알림이 적시에 전달되는 것을 보장해야 합니다.



## 7. 확장성 및 성능 최적화

알림 시스템이 대규모 트래픽을 처리하기 위해서는 고성능을 유지하면서 확장성을 확보하는 것이 중요합니다. 이를 위해 다음과 같은 전략을 사용할 수 있습니다.

### **7.1 이벤트 처리 최적화**

* **비동기 처리**: 이벤트를 비동기로 처리하여 시스템의 응답성을 높입니다. 이벤트 생성과 알림 전송을 독립적으로 처리함으로써 병목 현상을 줄일 수 있습니다.
* **배치 처리**: 일정량의 이벤트가 쌓이면 이를 배치로 처리하여 시스템 자원을 효율적으로 사용합니다. 예를 들어, 대량의 이메일을 한 번에 전송하기 위해 배치 작업을 활용할 수 있습니다.

### **7.2 데이터베이스 최적화**

* **인덱싱**: 알림 관련 데이터를 저장하는 데이터베이스에 적절한 인덱스를 추가하여 조회 속도를 높입니다. 특히, 사용자별 알림 설정이나 로그 데이터를 자주 조회하는 경우, 인덱스 최적화가 필요합니다.
* **캐싱**: 자주 접근하는 사용자 설정 정보나 알림 내용을 캐시에 저장하여 데이터베이스 접근 횟수를 줄입니다. Redis와 같은 메모리 기반 캐시 시스템을 활용할 수 있습니다.

### **7.3 시스템 모니터링 및 자동 확장**

* **모니터링 도구**: 시스템의 상태를 실시간으로 모니터링하여 문제가 발생할 가능성을 조기에 탐지합니다. Prometheus, Grafana와 같은 도구를 사용하여 알림 처리량, 지연 시간, 오류율 등을 추적할 수 있습니다.
* **자동 확장**: 클라우드 인프라를 사용하여 트래픽 증가에 따라 서버를 자동으로 확장합니다. 예를 들어, AWS의 오토스케일링 기능을 사용하여 필요 시 서버 인스턴스를 자동으로 추가할 수 있습니다.



## 8. 알림 시스템의 사례 연구

**8.1 대규모 전자상거래 플랫폼**

대규모 전자상거래 플랫폼에서 알림 시스템은 중요한 역할을 합니다. 사용자가 상품을 구매하거나, 배송 상태가 변경될 때마다 실시간으로 알림을 받을 수 있어야 합니다.

* **이벤트 발생**: 사용자가 결제를 완료하거나 상품이 배송 준비 상태로 전환될 때 이벤트가 발생합니다.
* **알림 생성 및 전송**: 이벤트 발생 후, 알림 생성기는 해당 이벤트를 분석하여 사용자가 설정한 채널로 알림을 전송합니다. 예를 들어, 결제 완료 알림은 이메일로, 배송 상태 변경 알림은 푸시 알림으로 전송됩니다.
* **확장성 관리**: 할인 이벤트 기간 동안 트래픽이 급증하는 경우를 대비해 시스템이 자동으로 확장될 수 있도록 설계합니다. 이를 통해 수십만 명의 사용자에게 동시에 알림을 보낼 수 있습니다.

**8.2 소셜 미디어 플랫폼**

소셜 미디어 플랫폼에서는 사용자가 친구의 새로운 게시물, 댓글, 메시지 등을 빠르게 인지할 수 있도록 알림 시스템을 활용합니다.

* **이벤트 발생**: 사용자가 새로운 게시물을 작성하거나 댓글을 달 때 이벤트가 발생합니다.
* **사용자 맞춤 알림**: 사용자의 알림 설정에 따라 특정 친구의 게시물에 대해서만 알림을 받거나, 모든 활동에 대해 알림을 받도록 설정할 수 있습니다.
* **실시간 처리**: 소셜 미디어의 특성상 실시간성이 매우 중요합니다. 사용자가 앱을 열지 않아도 푸시 알림을 통해 실시간으로 중요한 소식을 전달받을 수 있어야 합니다.



## 9. 장애 대응 및 복구 계획

알림 시스템이 중단 없이 동작하도록 하기 위해서는 장애 발생 시에도 신속하게 대응할 수 있는 복구 계획을 마련해야 합니다.

### **9.1 장애 시나리오 분석**

* **알림 전송 실패**: 네트워크 문제나 전송 채널의 장애로 인해 알림 전송이 실패할 수 있습니다. 이 경우, 시스템은 자동으로 재시도를 시도하거나, 다른 채널을 통해 대체 전송을 시도합니다.
* **시스템 과부하**: 갑작스러운 트래픽 증가로 인해 시스템이 과부하 상태가 될 수 있습니다. 이를 해결하기 위해 오토스케일링과 같은 자동 확장 기능을 활용합니다.

### **9.2 데이터 복구 및 롤백**

* **이벤트 재처리**: 장애로 인해 처리되지 않은 이벤트는 큐에 저장된 상태로 남아있으며, 시스템이 정상화되면 자동으로 재처리됩니다.
* **데이터 백업 및 복원**: 알림 로그와 사용자 설정 데이터는 주기적으로 백업되어야 하며, 장애 발생 시 이를 복원할 수 있는 절차가 마련되어야 합니다.
