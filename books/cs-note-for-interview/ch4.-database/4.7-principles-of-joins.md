---
description: 조인의 원리
---

# 4.7 Principles of Joins

조인의 종류를 이해한 후, 조인이 데이터베이스에서 어떻게 구현되는지를 이해하는 것도 중요합니다. 데이터베이스는 조인을 수행할 때 다양한 알고리즘을 사용하여 효율적으로 데이터를 결합합니다. 이 섹션에서는 주요 조인 알고리즘인 중첩 루프 조인, 정렬 병합 조인, 해시 조인에 대해 다룹니다.

#### 4.7.1 중첩 루프 조인 (Nested Loop Join)

\*\*중첩 루프 조인(Nested Loop Join)\*\*은 가장 단순한 형태의 조인 알고리즘입니다. 이 방식은 두 테이블을 중첩된 반복문을 통해 결합합니다. 하나의 테이블의 각 행에 대해 다른 테이블의 모든 행을 반복적으로 비교하여 조인 조건을 만족하는 행을 찾습니다. 중첩 루프 조인은 작은 테이블을 조인할 때는 효과적이지만, 대규모 테이블에서는 비효율적일 수 있습니다.

**예시**:\
두 테이블 `A`와 `B`가 있다고 가정합니다. 중첩 루프 조인은 다음과 같은 방식으로 작동합니다:

```sql
FOR each row in Table A
    FOR each row in Table B
        IF A.column = B.column
            THEN output the row
```

즉, `Table A`의 각 행을 가져와 `Table B`의 모든 행과 비교한 후, 조인 조건이 일치하는 경우 해당 행을 결과에 포함합니다.

```sql
SELECT * FROM customers, orders
WHERE customers.id = orders.customer_id;
```

이 쿼리는 고객 테이블의 각 행에 대해 주문 테이블의 모든 행을 비교하여 조인 조건을 만족하는 행을 찾는 중첩 루프 조인을 사용합니다.

#### 4.7.2 정렬 병합 조인 (Sort-Merge Join)

\*\*정렬 병합 조인(Sort-Merge Join)\*\*은 두 테이블이 조인 조건에 따라 미리 정렬되어 있을 때, 매우 효율적인 조인 알고리즘입니다. 이 방법은 두 테이블의 데이터를 조인 키에 따라 정렬한 후, 각 테이블의 첫 번째 행부터 시작해 비교하며 병합합니다. 정렬 병합 조인은 대규모 데이터 집합을 처리할 때도 효율적입니다.

**예시**:\
두 테이블 `A`와 `B`가 각각 정렬되어 있다고 가정합니다. 정렬 병합 조인은 다음과 같이 작동합니다:

```sql
1. 두 테이블을 조인 키로 정렬한다.
2. 각 테이블에서 첫 번째 행을 비교한다.
3. 조인 조건이 일치하면 행을 결합하고 다음 행으로 이동한다.
4. 조건이 일치하지 않으면 작은 쪽의 행을 다음으로 이동한다.
5. 테이블의 끝에 도달할 때까지 반복한다.
```

```sql
SELECT * FROM customers
JOIN orders ON customers.id = orders.customer_id
ORDER BY customers.id;
```

이 쿼리는 두 테이블을 고객 ID로 정렬한 후 병합하여 조인합니다. 이 방식은 특히 두 테이블이 미리 정렬되어 있을 때 매우 효과적입니다.

#### 4.7.3 해시 조인 (Hash Join)

\*\*해시 조인(Hash Join)\*\*은 해시 테이블을 사용하여 조인을 수행하는 알고리즘으로, 조인 조건이 `=`(등가 조건)일 때 주로 사용됩니다. 이 방법은 두 단계로 나뉩니다: 빌드 단계와 프로브 단계.

1. **빌드 단계**: 작은 테이블의 조인 키를 기반으로 해시 테이블을 생성합니다.
2. **프로브 단계**: 큰 테이블의 각 행에 대해 해시 테이블을 조회하여 일치하는 행을 찾습니다.

**예시**:\
두 테이블 `A`와 `B`가 있다고 가정합니다. 해시 조인은 다음과 같이 작동합니다:

```sql
1. Table A의 조인 키를 사용하여 해시 테이블을 생성한다. (빌드 단계)
2. Table B의 각 행을 읽어, 해시 테이블에서 일치하는 키를 찾는다. (프로브 단계)
3. 일치하는 키가 있으면 두 행을 결합한다.
```

```sql
SELECT * FROM customers
JOIN orders ON customers.id = orders.customer_id;
```

이 쿼리는 고객 테이블을 기반으로 해시 테이블을 생성하고, 주문 테이블에서 고객 ID를 사용해 해시 테이블에서 일치하는 값을 찾아 결합합니다. 해시 조인은 특히 테이블이 메모리에 충분히 맞을 때 매우 빠르게 작동합니다.
