---
description: 클라이언트와 서버
---

# Client & Server

## 1. 기본 개념

### 1.1 Client

클라이언트는 서비스를 요청하는 주체입니다. 보통 사용자 또는 애플리케이션을 대표하며, 데이터를 요청하거나 처리된 결과를 받습니다.

### 1.2. Server

서버는 클라이언트의 요청을 받아 데이터를 처리하고 응답을 반환하는 주체. 데이터를 저장하거나 특정 기능(인증, 파일 등)을 제공합니다.

### 1.3. Client-Server Model

클라이언트는 요청(Request)를 보내고, 서버는 응답(Response)을 반환하는 구조.



## 2. 동작 원리

### 2.1. IP주소 얻기

클라이언트와 서버는 서로 상호작용하며, 약속된 프로토콜을 통해 데이터를 주고 받습니다. IP주소와 포트를 사용하여 서로를 식별하게 됩니다.

> 약속된 프로토콜: Http/Https, TCP/IP, UDP

1. URL 입력: 유저는 도메인url을 클라이언트 웹브라우저에 입력합니다.
2. hosts 파일 확인: hosts 파일은 사용자가 수동으로 관리합니다. DNS 캐시 포이즈닝으로 공격자가 DNS서버에 잘못된 응답을 전송하거나 DNS 서버의 응답을 변조하여 오염된 데이터를 캐시에 저장하게끔 하는 공격이 발생할 수 있기떄문에 가장 먼저 확인합니다.
3. 브라우저 캐시 확인: 브라우저는 브라우저 캐시(DNS 캐시)를 확인합니다.
4. OS 캐시 확인: 브라우저가 DNS조회를 위해 OS가 제공하는 네트워크 API를 시스템 콜을 수행하여 OS 캐시를 확인합니다. OS캐시는 TTL이 존재하며, 메모리에 저장됩니다.
5. 로컬 DNS 리졸버로 질의: 로컬 DNS 리졸버(isp, 인터넷 서비스 제공자에서 제공하는 DNS 서버)에 도메인 이름을 질의. 로컬 DNS 리졸버는 이전 요청에 대한 결과를 TTL 동안 캐싱하고 있습니다. 캐시 미스가 발생하면 로컬 DNS 리졸버가 재귀적으로 질의를 수행합니다.
6. 루트 DNS 서버로 요청: 루트 DNS는 13개의 클러스터로 분산되어 있으며, 최상위 레벨 TLD를 관리합니다. 루트서버는 도메인의 IP주소를 반환하지 않고, .com/.net 등 다음 TLD 서버의 위치를 반환합니다. \
   (.com의 네임서버의 주소)
7. TLD 네임서버로 요청: 로컬 리졸버는 루트 DNS 서버의 응답을 통해, TLD 네임서버에 질의합니다. TLD 네임서버는 권한 네임서버(Authroitative Name Server)의 위치를 반환합니다. \
   (example.com의  권한 네임서버의 주소)
8. 권한 네임서버로 요청: 도메인에 대한 최종 정보를 보유한 서버입니다. 권한 네임서버에서 IP주소를 요청하게 되며, 응답으로 IP주소를 처음에 반복적 질의를 했던 로컬 DNS 리졸버에 반환합니다. 권한 네임서버는 A레코드(IPv4 주소), AAAA레코드(IPv6 주소), CNAME레코드(리다이렉션 주소)를 저장하고 있습니다. 리다이렉션 주소를 반환받으면 해당 주소를 브라우저에 반환하고, Hosts 파일 확인부터 다시 실행.
9. 로컬 DNS 리졸버의 응답: 최종적으로 권한 네임서버로부터 받은 IP를 브라우저에 반환합니다.



### 2.2. 서버와의 연결 설정

1. 클라이언트는 반환된 IP주소와 서버의 지정된 포트(https:433, http:80 기본값)으로 연결을 시도합니다.
2. 3 way-handshake 1단계: 클라이언트가 랜덤ISN을 생성해서 서버측에 보냅니다.
3. 2단계: 서버측에서는 받은 Syn값에 1을 더한 Ack와, 서버의 ISN을 생성해서 Syn값으로 보냅니다.
4. 3단계: 클라이언트측에서는 서버의 Syn과 클라이언트의 Ack를 받게됩니다. 이때 다시 서버의 syn+1을 Ack값으로 서버에 보내게됩니다. 서버측은 소켓 테이블에 클라이언트 정보를 등록합니다.\
   소켓은 클라이언트와 서버 간 데이터를 주고받기 위해 필요한 논리적인 개념이고, 실제로는 요청에서 클라이언트 정보를 받아서 소켓 테이블을 확인합니다. 소켓은 운영체제의 커널에서 생성되고 관리됩니다. 서버는 소켓이 열려있지 않은 요청이 들어오면 무시하거나 새로운 연결로 처리하고, 4 way handshake가 발생하면 소켓 테이블에서 정보를 삭제합니다.
5. TLS Handshake 1단계: 클라이언트 Hello를 보냅니다. 클라이언트가 사용할 수 있는 암호화 알고리즘, TLS 버전, 랜덤값, 세션 ID가 포함됩니다.
6. 2단계:&#x20;



